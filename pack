#! /bin/bash

ZIP="/bin/zip"

key=$1
filename=$2
new_folder=$3
res='result_packed'

pk() { $ZIP -r $1.zip $1; }
# pk folder

encrypt() { gpg -r $1 --encrypt $2; }
# encrypt mykey@abc.net folder.zip

# pack <gpg_public_key_fingerpring> <existing.zip.gpg> new_folder/

dated_name() { echo "$1_$(date '+%Y%m%d_%H%M')"; }
rename_folder() { mv $1 $(dated_name $1); echo $(dated_name $1); }

dated_new_folder=$(rename_folder $new_folder)

mkdir $res
mv $dated_new_folder $res
mv $filename $res

pk $res
encrypt $1 ${res}.zip

rm -rf ${res}
rm ${res}.zip
